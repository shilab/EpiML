<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}
    <title>Result | Shilab web server</title>
{% endblock %}
{% block styles %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/dt/dt-1.10.16/sl-1.2.5/datatables.min.css">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static',filename='css/vis_CN.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static',filename='css/vis_ER.css') }}">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static',filename='css/vis_AM.css') }}">
    <style>
        .table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
            background-color: coral;
        }
    </style>
{% endblock %}

{% block content %}
    <div>
        <section>
            <h2>Summary</h2>
            <p>Your job is finished, and the summaries are listed in following. You can download results and report
                through corresponding links, or directly check your results using following interactive tables and
                visualizations.</p>
            <style type="text/css">
                .tg {
                    border-collapse: collapse;
                    border-spacing: 0;
                }

                .tg td {
                    font-family: Arial, sans-serif;
                    font-size: 14px;
                    padding: 10px 20px;
                    border-style: solid;
                    border-width: 1px;
                    overflow: hidden;
                    word-break: normal;
                    border-color: black;
                }

                .tg th {
                    font-family: Arial, sans-serif;
                    font-size: 14px;
                    font-weight: normal;
                    padding: 10px 20px;
                    border-style: solid;
                    border-width: 1px;
                    overflow: hidden;
                    word-break: normal;
                    border-color: black;
                }

                .tg .tg-odlp {
                    font-size: medium;
                    background-color: #ecf4ff;
                    color: #333333;
                    border-color: inherit;
                    text-align: center;
                    vertical-align: top
                }

                .tg .tg-iu9n {
                    font-size: medium;
                    background-color: #ffffff;
                    border-color: inherit;
                    text-align: left;
                    vertical-align: top
                }

                .tg .tg-t70x {
                    font-size: medium;
                    background-color: #ecf4ff;
                    border-color: #333333;
                    text-align: center;
                    vertical-align: top
                }

                .tg .tg-o36v {
                    font-size: medium;
                    background-color: #ecf4ff;
                    border-color: inherit;
                    text-align: center;
                    vertical-align: top
                }

                .tg .tg-wq9i {
                    font-size: medium;
                    background-color: #ecf4ff;
                    color: #333333;
                    border-color: inherit;
                    text-align: center
                }

                .tg .tg-vg4w {
                    font-size: medium;
                    background-color: #efefef;
                    border-color: inherit;
                    text-align: center;
                    vertical-align: top
                }
            </style>
            <table class="tg" width="100%">
                <tr>
                    <th class="tg-odlp">Job name</th>
                    <th class="tg-iu9n">{{ job.name }}</th>
                    <th class="tg-t70x">Category</th>
                    <th class="tg-iu9n">{{ job.category }}</th>
                    <th class="tg-o36v">Method</th>
                    <th class="tg-iu9n">{{ job.selected_algorithm }}</th>
                </tr>
                <tr>
                    <td class="tg-odlp">Started</td>
                    <td class="tg-iu9n">{{ momentjs(job.timestamp).calendar() }}</td>
                    <td class="tg-t70x">Execution time</td>
                    <td class="tg-iu9n">{{ job.running_time }}</td>
                    <td class="tg-o36v">Status</td>
                    <td class="tg-iu9n">{{ job.status }}</td>
                </tr>
                <tr>
                    <td class="tg-odlp">Description</td>
                    <td class="tg-iu9n" colspan="5">{{ job.description }}</td>
                </tr>
                <tr>
                    <td class="tg-wq9i" rowspan="2">Input</td>
                    <td class="tg-vg4w">feature matrix</td>
                    <td class="tg-iu9n" colspan="2"><a
                            href="{{ url_for('download_result',jobid= job.id , filename=job.feature_file) }}"
                            target="_blank">{{ job.feature_file }}</a></td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">{{ feature_file_size }} KB</td>
                </tr>
                <tr>
                    <td class="tg-vg4w">label matrix</td>
                    <td class="tg-iu9n" colspan="2"><a
                            href="{{ url_for('download_result',jobid= job.id , filename=job.label_file) }}"
                            target="_blank">{{ job.label_file }}</a></td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">{{ lable_file_size }} KB</td>
                </tr>
                <tr>
                    <td class="tg-wq9i" rowspan="2">Output</td>
                    <td class="tg-vg4w">Main effect</td>
                    <td class="tg-iu9n" colspan="2"><a
                            href="{{ url_for('download_result',jobid= job.id , filename='main_result.txt') }}"
                            target="_blank">Main effect</a></td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">{{ main_result_size }} KB</td>
                </tr>
                <tr>
                    <td class="tg-vg4w">Epistatic effect</td>
                    <td class="tg-iu9n" colspan="2"><a
                            href="{{ url_for('download_result',jobid=job.id, filename='epis_result.txt') }}"
                            target="_blank">Epistatic effect</a></td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">{{ epis_result_size }} KB</td>
                </tr>
                <tr>
                    <td class="tg-odlp">Report</td>
                    <td class="tg-iu9n" colspan="3">bioRxiv report</td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">0.5 MB</td>
                </tr>
                <tr>
                    <td class="tg-odlp">Notebook</td>
                    <td class="tg-iu9n" colspan="3">Jupyter notebook; pre-configured docker container</td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">0.5 MB</td>
                </tr>
                <tr>
                    <td class="tg-odlp">Zip archive</td>
                    <td class="tg-iu9n" colspan="3"></td>
                    <td class="tg-o36v">size</td>
                    <td class="tg-iu9n">0.5 MB</td>
                </tr>
            </table>


        </section>


        <section>
            <hr>
            <h2>Result</h2>

            <h3>Main Effect</h3>
            <div>
                <table id="main_effect" name="main_effect" class="table table-hover stripe">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Feature</th>
                        <th>Coefficent value</th>
                        <th>Posterior variance</th>
                        <th>t-value</th>
                        <th>p-value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for line in EBEN_main_result %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ line[0] }}</td>
                            <td>{{ line[1] }}</td>
                            <td>{{ line[2] }}</td>
                            <td>{{ line[3] }}</td>
                            <td>{{ line[4] }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        <section>
            <h3>Epistatic Effect</h3>
            <div>
                <table id="epis_effect" name="epis_effect" class="table table-hover stripe ">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Feature 1</th>
                        <th>Feature 2</th>
                        <th>Coefficent value</th>
                        <th>Posterior variance</th>
                        <th>t-value</th>
                        <th>p-value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for line in EBEN_epis_result %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ line[0] }}</td>
                            <td>{{ line[1] }}</td>
                            <td>{{ line[2] }}</td>
                            <td>{{ line[3] }}</td>
                            <td>{{ line[4] }}</td>
                            <td>{{ line[5] }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        <section>
            <hr>
            <h2>Visualization</h2>
            <h3>Circle Network</h3>
            <p> A circle network shows the interactions between epistatic features.
            </p>

            <div class="row" style="padding: 10px">
                <div class="col-sm-3">
                    <p style="font-size: medium">
                        Mouseover any of nodes in this network to see its <span style="color: #d62728;">associative features in red</span>.
                    </p>
                    <p style="font-size: medium">
                        Click one node to find details in above Epistatic Effect table. Double click on graph back
                        to default.
                    </p>

                    <!--//TODO: add datatables mouseover events -->
                    <p></p>
                    <div>
                        <button id='cn_saveAsPNG' style="margin: 10px">Save as PNG</button>
                        <button id='cn_saveAsSVG' style="margin: 10px">Save as SVG</button>
                    </div>
                </div>

                <div id="vis_cn" class="col-sm-9" align="center">
                    <svg name="circle_network" id="circle_network"></svg>
                </div>
                <!-- for hierarchical edge bundling graph -->
                <script>
                    var cn_graph_json = {{ cn_graph_json|safe }};
                </script>
                <script type="text/javascript" charset="utf8"
                        src="{{ url_for('static', filename='js/vis_CN.js') }}">
                </script>
            </div>

        </section>
        <section>
            <h3>Adjacency Matrix</h3>
            <div>
                <p> A network can be represented by an adjacency matrix, where each cell (<i>i</i>, <i>j</i>)
                    represents an
                    edge from vertex <i>i</i> to vertex <i>j</i>. Here, vertices represent features in epistatic
                    effect, while
                    edges represent coefficient value.</p>
                <p> While network diagram can give a good view for node-link relationship, adjacency matrix diagram
                    has other advantages. As networks get large and highly connected, diagrams
                    often devolve into giant hairballs of line crossings. Line crossings are impossible with
                    matrix views. Matrix cells can also be encoded to show additional data.
                </p>
                <!-- <p>add adjacent matrix. There is an example: https://bost.ocks.org/mike/miserables/</p>-->
            </div>
            <div class="row" style="padding: 10px">
                <div class="col-sm-2">
                    <aside>
                        <p style="font-size: medium;">
                            Matrix cell depicts coefficent value in epistatic effect table.
                        </p>
                        <p style="font-size: medium;">
                            Blue cells indicate positive value, and purple cells indicate negative value. The darker
                            cells indicate strong interaction.
                        </p>
                        <p style="font-size: medium">
                            Use the drop-down menu to reorder the matrix and explore the data.
                        </p>
                        <p style="font-size: medium">Order: <select id="order">
                            <option value="name">by Name</option>
                            <option value="count">by Count</option>
                            <option value="rank">by Position</option>
                        </select>
                        </p>
                    </aside>
                </div>
                <div class="col-sm-offset-1 col-sm-8" id="vis_am" name="vis_am">
                    <svg id="adjacency_matrix" name="adjacency_matrix"></svg>
                </div>
                <script>
                    var am_graph_json = '{{ am_graph_json}}';
                </script>
                <script src="{{ url_for('static',filename='js/vis_AM.js') }}"></script>
            </div>
        </section>
        <section>
            <h3>External Resources</h3>
            <div id="visualization" class="container">
                <p>Relationship between miRNAs and target genes. The mega data can be download
                    <a href="{{ url_for('download_result',jobid=jobid, filename='nodes_links.json') }}"
                       target="_blank">here</a> in
                    JSON format.</p>
                <div class="row">
                    <div class=" col-sm-6">
                        <!-- automatically add legend in vis_ER_legend.js -->
                        <div id="ER_legendDiv" class="row"></div>
                        <!--
                        <label>
                            <input type="checkbox" class="filter-ckb" value="Main effect" checked> Main
                            effect</label>
                        <label><input type="checkbox" class="filter-ckb" value="Epistatic effect" checked>
                            Epistatic effect</label>
                        <label> <input type="checkbox" class="filter-ckb" value="Target gene" checked> Target
                            gene</label>
                        -->
                    </div>
                    <div class=" col-sm-6" align="right">
                        <button id='ER_saveAsPNG'>Save as PNG</button>
                        <button id='ER_saveAsSVG'>Save as SVG</button>
                        <label>Search: <input id="searchNode" name="searchNode" type="text"
                                              oninput="searchERNode(this.value)"/></label>
                    </div>
                </div>
                <div style="padding-top: 10px">
                    <!--<svg name="ER_legend" id="ER_legend"></svg>-->
                    <svg name="ER_diagram" id="ER_diagram"></svg>
                </div>
                <!-- for d3 visualization. This script must be after svg tag-->
                <script>
                    var nodes_links_json = '{{ nodes_links_json }}';
                    var legends_json = '{{ legends_json }}';
                </script>

                <script type="text/javascript" charset="utf8"
                        src="{{ url_for('static', filename='js/vis_ER_legend.js') }}"></script>
                <script type="text/javascript" charset="utf8"
                        src="{{ url_for('static', filename='js/vis_ER.js') }}"></script>
            </div>
        </section>

    </div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <!-- for datatables -->
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/v/dt/dt-1.10.16/sl-1.2.5/datatables.min.js"></script>

    <!-- for visualization -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- for interaction -->
    <script src="{{ url_for('static',filename='js/vis_interaction.js') }}"></script>
    <!-- for save as -->
    <script src="{{ url_for('static',filename='js/saveSvgAsPng.js') }}"></script>
    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>

{% endblock %}